2025-10-29 12:44:00 - __main__ - INFO - [<module>:47] - ================================================================================
2025-10-29 12:44:00 - __main__ - INFO - [<module>:48] - LangChain Math Agent Test Runner Started
2025-10-29 12:44:00 - __main__ - INFO - [<module>:49] - Log file: logs\math_agent_test_20251029_124400.log
2025-10-29 12:44:00 - __main__ - INFO - [<module>:50] - ================================================================================
2025-10-29 12:44:03 - __main__ - DEBUG - [<module>:57] - MathAgent imported successfully
2025-10-29 12:44:03 - __main__ - INFO - [main:269] - 
================================================================================
2025-10-29 12:44:03 - __main__ - INFO - [main:270] - MAIN: Starting test configuration
2025-10-29 12:44:03 - __main__ - INFO - [main:271] - ================================================================================
2025-10-29 12:44:03 - __main__ - INFO - [main:275] - Base directory: C:\Users\User\PycharmProjects\MathAgent
2025-10-29 12:44:03 - __main__ - DEBUG - [main:278] - Questions directory: C:\Users\User\PycharmProjects\MathAgent\QAs
2025-10-29 12:44:03 - __main__ - INFO - [main:281] - Model selection priority:
2025-10-29 12:44:03 - __main__ - INFO - [main:283] -   1. ✓ Using provided argument: google_genai:gemini-2.5-flash
2025-10-29 12:44:03 - __main__ - INFO - [main:296] - Final model choice: google_genai:gemini-2.5-flash
2025-10-29 12:44:03 - __main__ - INFO - [main:299] - 
API Key status:
2025-10-29 12:44:03 - __main__ - INFO - [main:303] -   GOOGLE_API_KEY: ✓ Set
2025-10-29 12:44:03 - __main__ - INFO - [main:320] - 
File paths:
2025-10-29 12:44:03 - __main__ - INFO - [main:322] -   Input CSV: C:\Users\User\PycharmProjects\MathAgent\QAs\test_questions_mathform4.csv
2025-10-29 12:44:03 - __main__ - INFO - [main:325] -   Image folder: C:\Users\User\PycharmProjects\MathAgent\QAs\Soalan maths\form 4
2025-10-29 12:44:03 - __main__ - DEBUG - [main:328] -   Output directory: C:\Users\User\PycharmProjects\MathAgent\QAs\langchain_results
2025-10-29 12:44:03 - __main__ - INFO - [main:333] -   Output CSV: C:\Users\User\PycharmProjects\MathAgent\QAs\langchain_results\test_results_form4_google_genai_gemini_2.5_flash_langchain_agent.csv
2025-10-29 12:44:03 - __main__ - INFO - [main:336] - 
Validating input files:
2025-10-29 12:44:03 - __main__ - INFO - [main:340] -   ✓ Input CSV exists
2025-10-29 12:44:03 - __main__ - INFO - [main:345] -   ✓ Image folder exists
2025-10-29 12:44:03 - __main__ - INFO - [main:350] -   ✓ Found 29 images in folder
2025-10-29 12:44:03 - __main__ - INFO - [main:355] - 
Creating output directory:
2025-10-29 12:44:03 - __main__ - INFO - [main:358] -   ✓ Output directory ready: C:\Users\User\PycharmProjects\MathAgent\QAs\langchain_results
2025-10-29 12:44:03 - __main__ - INFO - [main:363] - 
================================================================================
2025-10-29 12:44:03 - __main__ - INFO - [main:364] - Configuration complete. Starting image processing...
2025-10-29 12:44:03 - __main__ - INFO - [main:365] - ================================================================================

2025-10-29 12:44:03 - __main__ - INFO - [process_test_images:90] - Starting process_test_images
2025-10-29 12:44:03 - __main__ - INFO - [process_test_images:91] -   Input CSV: C:\Users\User\PycharmProjects\MathAgent\QAs\test_questions_mathform4.csv
2025-10-29 12:44:03 - __main__ - INFO - [process_test_images:92] -   Image folder: C:\Users\User\PycharmProjects\MathAgent\QAs\Soalan maths\form 4
2025-10-29 12:44:03 - __main__ - INFO - [process_test_images:93] -   Output CSV: C:\Users\User\PycharmProjects\MathAgent\QAs\langchain_results\test_results_form4_google_genai_gemini_2.5_flash_langchain_agent.csv
2025-10-29 12:44:03 - __main__ - INFO - [process_test_images:94] -   Model: google_genai:gemini-2.5-flash
2025-10-29 12:44:03 - __main__ - INFO - [process_test_images:97] - Reading input CSV from C:\Users\User\PycharmProjects\MathAgent\QAs\test_questions_mathform4.csv...
2025-10-29 12:44:03 - __main__ - INFO - [process_test_images:105] - CSV loaded successfully. Total rows: 29
2025-10-29 12:44:03 - __main__ - DEBUG - [process_test_images:106] - Columns in CSV: ['image_filename', 'ground_truth', 'marking_scheme', 'chapter_name', 'language', 'Textbook', 'Allocated marks']
2025-10-29 12:44:03 - __main__ - DEBUG - [process_test_images:117] - All required columns present: ['image_filename', 'ground_truth', 'marking_scheme']
2025-10-29 12:44:03 - __main__ - DEBUG - [process_test_images:120] - Adding result columns to DataFrame
2025-10-29 12:44:03 - __main__ - INFO - [initialize_math_agent:62] - Initializing MathAgent with model: google_genai:gemini-2.5-flash
2025-10-29 12:44:07 - __main__ - DEBUG - [initialize_math_agent:65] - MathAgent initialized successfully
2025-10-29 12:44:07 - __main__ - INFO - [process_test_images:138] - Processing 29 images with 2-stage pipeline (Extraction → Solving)...
2025-10-29 12:44:07 - __main__ - INFO - [process_test_images:144] - 
================================================================================
2025-10-29 12:44:07 - __main__ - INFO - [process_test_images:145] - [1/29] Processing: Chapter 1_Q1.png
2025-10-29 12:44:07 - __main__ - DEBUG - [process_test_images:146] - Image path: C:\Users\User\PycharmProjects\MathAgent\QAs\Soalan maths\form 4\Chapter 1_Q1.png
2025-10-29 12:44:07 - __main__ - INFO - [process_test_images:164] -   Stage 1: Extracting structured data from image...
2025-10-29 12:44:07 - __main__ - INFO - [process_test_images:165] -   Stage 2: Solving with mathematical tools...
2025-10-29 12:44:20 - __main__ - DEBUG - [process_test_images:168] - Agent.process_image returned: <class 'dict'>
2025-10-29 12:44:20 - __main__ - DEBUG - [process_test_images:175] - Result keys: ['extracted_data', 'llm_answer', 'tokens_used', 'status', 'model']
2025-10-29 12:44:20 - __main__ - DEBUG - [process_test_images:178] - Storing results in DataFrame at row 0...
2025-10-29 12:44:20 - __main__ - DEBUG - [process_test_images:182] -   extracted_data (first 200 chars): 'list' object has no attribute 'startswith'...
2025-10-29 12:44:20 - __main__ - DEBUG - [process_test_images:184] -   ✓ extracted_data saved
2025-10-29 12:44:20 - __main__ - DEBUG - [process_test_images:188] -   llm_answer (first 200 chars): Error: 'list' object has no attribute 'startswith'...
2025-10-29 12:44:20 - __main__ - DEBUG - [process_test_images:190] -   ✓ llm_answer saved
2025-10-29 12:44:20 - __main__ - DEBUG - [process_test_images:194] -   tokens_used: 0
2025-10-29 12:44:20 - __main__ - DEBUG - [process_test_images:196] -   ✓ tokens_used saved
2025-10-29 12:44:20 - __main__ - DEBUG - [process_test_images:200] -   status: ERROR
2025-10-29 12:44:20 - __main__ - DEBUG - [process_test_images:202] -   ✓ status saved
2025-10-29 12:44:20 - __main__ - DEBUG - [process_test_images:206] -   model: google_genai:gemini-2.5-flash
2025-10-29 12:44:20 - __main__ - DEBUG - [process_test_images:208] -   ✓ model saved
2025-10-29 12:44:20 - __main__ - WARNING - [process_test_images:218] -   ✗ ERROR | Tokens: 0 | Running total: 0
2025-10-29 12:44:20 - __main__ - WARNING - [process_test_images:219] -   Error details: Error: 'list' object has no attribute 'startswith'
2025-10-29 12:44:20 - __main__ - INFO - [process_test_images:144] - 
================================================================================
2025-10-29 12:44:20 - __main__ - INFO - [process_test_images:145] - [2/29] Processing: Chapter 1_Q2.png
2025-10-29 12:44:20 - __main__ - DEBUG - [process_test_images:146] - Image path: C:\Users\User\PycharmProjects\MathAgent\QAs\Soalan maths\form 4\Chapter 1_Q2.png
2025-10-29 12:44:20 - __main__ - INFO - [process_test_images:164] -   Stage 1: Extracting structured data from image...
2025-10-29 12:44:20 - __main__ - INFO - [process_test_images:165] -   Stage 2: Solving with mathematical tools...
